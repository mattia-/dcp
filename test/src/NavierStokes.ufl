# UFL file for Navier-Stokes simulation
#
# define mesh dimension
cell = triangle

# define function spaces
V = VectorElement ("Lagrange", cell, 2)
Q = FiniteElement ("Lagrange", cell, 1)
T = V * Q

# define test and trial functions
trial = Coefficient (T)
test = TestFunction (T)

u, p = split (trial)
v, q = split (test)

# define coefficients
nu = Constant (cell)
F = nu * inner (nabla_grad (u), nabla_grad (v)) * dx \
     + inner (dot (nabla_grad (u), u), v) * dx \
     - inner (p, nabla_div (v)) * dx \
     + inner (nabla_div (u), q) * dx

dtrial = TrialFunction (T)
du, dp = split (dtrial)
#J = derivative (F, trial, dtrial) 
J = nu * inner (nabla_grad (du), nabla_grad (v)) * dx \
     + inner (dot (nabla_grad (u), du), v) * dx \
     + inner (dot (nabla_grad (du), u), v) * dx \
     - inner (dp, nabla_div (v)) * dx \
     + inner (nabla_div (du), q) * dx
